{"version":3,"sources":["webpack:///./src/views/order/CreateOrder.vue","webpack:///./src/views/order/CreateOrder.vue?2908","webpack:///./node_modules/core-js/modules/es.function.name.js","webpack:///./src/views/order/CreateOrder.vue?b9a8","webpack:///./src/network/order.js"],"names":["class","alt","default","goTo","address","name","phone","province","city","county","cartList","item","index","key","goods","cover_url","title","num","price","total","button-text","handleCreateOrder","closeable","close-on-click-overlay","show","showPay","position","style","close","border","column-num","width","height","src","aliyun","wechat","components","NavBar","setup","router","store","state","orderNo","init","loading","message","forbidClick","then","res","filter","n","is_default","length","carts","clear","push","path","params","address_id","id","dispatch","type","qr_code_url","console","log","timer","setInterval","clearInterval","query","sum","forEach","parseInt","parseFloat","__exports__","render","DESCRIPTORS","FUNCTION_NAME_EXISTS","EXISTS","defineProperty","f","FunctionPrototype","Function","prototype","FunctionPrototypeToString","toString","nameRE","NAME","configurable","get","call","this","match","error","createOrder","request","url","method","getOrderPreview","payOrder","order","payOrderStatus","getOrderList","getOrderDetail","include","confirmOrder"],"mappings":"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","file":"js/chunk-7d4d9fe0.b6c87515.js","sourcesContent":["<template>\r\n    <div class=\"create-order\">\r\n        <nav-bar class=\"nav-bar\">\r\n            <template v-slot:default>\r\n               定单预览\r\n            </template>\r\n        </nav-bar>\r\n\r\n        <div class=\"address-wrap\">\r\n            <div class=\"name\" @click=\"goTo\">\r\n                <span>{{address.name}}</span>\r\n                <span>{{address.phone}}</span>\r\n            </div>\r\n            <div class=\"address\">\r\n               {{address.province}} {{address.city}} {{address.county}} {{address.address}}\r\n            </div>\r\n            <van-icon class=\"arrow\" name=\"arrow\" />\r\n        </div>\r\n\r\n        <div class=\"good\">\r\n            <div class=\"good-item\" v-for=\"(item, index) in cartList\" :key=\"index\">\r\n                <div class=\"good-img\"><img v-lazy=\"item.goods.cover_url\" alt=\"\"></div>\r\n                <div class=\"good-desc\">\r\n                    <div class=\"good-title\">\r\n                        <span>{{item.goods.title}}</span>\r\n                        <span>x{{item.num}}</span>\r\n                    </div>\r\n                    <div class=\"good-btn\">\r\n                        <div class=\"price\"><small>¥</small> {{item.goods.price+'.00'}}</div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n\r\n\r\n\r\n        <van-submit-bar\r\n                class=\"submit-all\"\r\n                :price=\"total * 100\"\r\n                button-text=\"生成订单\"\r\n                @submit=\"handleCreateOrder\"\r\n        >\r\n            商品金额\r\n        </van-submit-bar>\r\n\r\n        <van-popup\r\n                closeable\r\n                :close-on-click-overlay=\"false\"\r\n                v-model:show=\"showPay\"\r\n                position=\"bottom\"\r\n                :style=\"{ height: '40%' }\"\r\n                @close=\"close\"\r\n        >\r\n\r\n            <van-grid :border=\"false\" :column-num=\"2\">\r\n                <van-grid-item>\r\n                    支付宝二维码<br>\r\n                    <van-image width=\"150\" height=\"150\" :src=\"aliyun\" />\r\n                </van-grid-item>\r\n                <van-grid-item>\r\n                    微信二维码<br>\r\n                    <van-image width=\"150\" height=\"150\" :src=\"wechat\" />\r\n                </van-grid-item>\r\n\r\n            </van-grid>\r\n\r\n        </van-popup>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\n    import { reactive, onMounted, toRefs, computed } from 'vue'\r\n    import NavBar from \"components/common/navbar/NavBar\";\r\n    import { getOrderPreview,createOrder,payOrder,payOrderStatus } from 'network/order'\r\n    import { Toast } from 'vant'\r\n    import { useRoute, useRouter } from 'vue-router'\r\n    import {useStore} from 'vuex';\r\n    export default {\r\n        components: {\r\n            NavBar\r\n        },\r\n        setup() {\r\n            const router = useRouter()\r\n            const route = useRoute()\r\n            const store = useStore()\r\n            const state = reactive({\r\n                cartList: [],\r\n                address: {},\r\n                showPay:false,\r\n                orderNo:'',\r\n                aliyun:'',\r\n                wechat:''\r\n            })\r\n\r\n            const init = ()=>{\r\n                Toast.loading({message:'加载中...', forbidClick:true});\r\n\r\n                getOrderPreview().then(res=>{\r\n                    let address = res.address.filter(n=>n.is_default == '1');\r\n\r\n                    if(address.length == 0) {\r\n                        state.address = {\r\n                            address:'还没有设置默认地址，请选择或填写地址信息'\r\n                        }\r\n                    }else{\r\n                        state.address = address[0];\r\n                    }\r\n                    state.cartList = res.carts;\r\n\r\n                    Toast.clear();\r\n\r\n                })\r\n            }\r\n\r\n            onMounted(() => {\r\n                init();\r\n            })\r\n\r\n\r\n            const goTo = () => {\r\n                router.push({ path: '/address'})\r\n            }\r\n\r\n\r\n\r\n            const handleCreateOrder = () => {\r\n                const params = {\r\n                    address_id: state.address.id\r\n                }\r\n                createOrder(params).then(res=>{\r\n                    Toast('创建定单成功');\r\n                    store.dispatch('updateCart');\r\n\r\n                    state.showPay = true;\r\n                    // 订单ID\r\n                    state.orderNo = res.id;\r\n\r\n                    payOrder(state.orderNo, {type:'aliyun'}).then(res=>{\r\n                            state.aliyun = res.qr_code_url;\r\n                            state.wechat = res.qr_code_url;\r\n                            console.log(\"创建支付的接口\", res);\r\n\r\n\r\n                    })\r\n\r\n                   /* payOrder(state.orderNo, {type:'wechat'}).then(res=>{\r\n                        console.log(res);\r\n                        state.wechat = res.qr_code_url;\r\n                    })*/\r\n\r\n                    // 轮询查看\r\n                    const timer = setInterval(()=>{\r\n                        payOrderStatus(state.orderNo).then(res=>{\r\n                            if(res=='2') {\r\n                                clearInterval(timer);\r\n                                router.push({path:'/orderdetail', query:{id:state.orderNo}})\r\n                            }\r\n                        })\r\n                    }, 2000)\r\n                })\r\n\r\n            }\r\n\r\n            const close = () => {\r\n                router.push({path:'/orderdetail', query:{id:state.orderNo}})\r\n            }\r\n\r\n            const total = computed(()=>{\r\n                let sum = 0;\r\n                state.cartList.forEach(item=>{\r\n                    sum += parseInt(item.num) * parseFloat(item.goods.price);\r\n                })\r\n                return sum;\r\n            })\r\n\r\n            return {\r\n                ...toRefs(state),\r\n                goTo,\r\n                handleCreateOrder,\r\n                close,\r\n                total\r\n            }\r\n        }\r\n    }\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n    .create-order {\r\n        background: #f9f9f9;\r\n        .address-wrap {\r\n            text-align: left;\r\n            margin-bottom: 20px;\r\n            background: #fff;\r\n            position: relative;\r\n            margin-top: 44px;\r\n            font-size: 14px;\r\n            padding: 15px;\r\n            color: #222333;\r\n            .name, .address {\r\n                margin: 10px 0;\r\n            }\r\n            .arrow {\r\n                position: absolute;\r\n                right: 10px;\r\n                top: 50%;\r\n                transform: translateY(-50%);\r\n                font-size: 20px;\r\n            }\r\n            &::before {\r\n                position: absolute;\r\n                right: 0;\r\n                bottom: 0;\r\n                left: 0;\r\n                height: 2px;\r\n                background: -webkit-repeating-linear-gradient(135deg, #ff6c6c 0, #ff6c6c 20%, transparent 0, transparent 25%, #1989fa 0, #1989fa 45%, transparent 0, transparent 50%);\r\n                background: repeating-linear-gradient(-45deg, #ff6c6c 0, #ff6c6c 20%, transparent 0, transparent 25%, #1989fa 0, #1989fa 45%, transparent 0, transparent 50%);\r\n                background-size: 80px;\r\n                content: '';\r\n            }\r\n        }\r\n        .good {\r\n            margin-bottom: 120px;\r\n        }\r\n        .good-item {\r\n            padding: 10px;\r\n            background: #fff;\r\n            display: flex;\r\n            .good-img {\r\n                img {\r\n                    width:100px;\r\n                    height:auto;\r\n                }\r\n            }\r\n            .good-desc {\r\n                display: flex;\r\n                flex-direction: column;\r\n                justify-content: space-between;\r\n                flex: 1;\r\n                padding: 20px;\r\n                .good-title {\r\n                    display: flex;\r\n                    justify-content: space-between;\r\n                }\r\n                .good-btn {\r\n                    display: flex;\r\n                    justify-content: space-between;\r\n                    .price {\r\n                        font-size: 16px;\r\n                        color: red;\r\n                        line-height: 28px;\r\n                    }\r\n                    .van-icon-delete {\r\n                        font-size: 20px;\r\n                        margin-top: 4px;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        .pay-wrap {\r\n            position: fixed;\r\n            bottom: 0;\r\n            left: 0;\r\n            width: 100%;\r\n            background: #fff;\r\n            padding: 10px 0;\r\n            padding-bottom: 50px;\r\n            border-top: 1px solid #e9e9e9;\r\n            >div {\r\n                display: flex;\r\n                justify-content: space-between;\r\n                padding: 0 5%;\r\n                margin: 10px 0;\r\n                font-size: 14px;\r\n                span:nth-child(2) {\r\n                    color: red;\r\n                    font-size: 18px;\r\n                }\r\n            }\r\n            .pay-btn {\r\n                position: fixed;\r\n                bottom: 7px;\r\n                right: 0;\r\n                left: 0;\r\n                width: 90%;\r\n                margin: 0 auto;\r\n            }\r\n        }\r\n    }\r\n    .submit-all {\r\n        margin-bottom: 50px;\r\n        z-index: 9 !important;\r\n    }\r\n</style>\r\n","import { render } from \"./CreateOrder.vue?vue&type=template&id=45e9bb03&scoped=true\"\nimport script from \"./CreateOrder.vue?vue&type=script&lang=js\"\nexport * from \"./CreateOrder.vue?vue&type=script&lang=js\"\n\nimport \"./CreateOrder.vue?vue&type=style&index=0&id=45e9bb03&lang=scss&scoped=true\"\n\nimport exportComponent from \"/Users/zmj/Desktop/vue-mobile/node_modules/vue-loader-v16/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-45e9bb03\"]])\n\nexport default __exports__","var DESCRIPTORS = require('../internals/descriptors');\nvar FUNCTION_NAME_EXISTS = require('../internals/function-name').EXISTS;\nvar defineProperty = require('../internals/object-define-property').f;\n\nvar FunctionPrototype = Function.prototype;\nvar FunctionPrototypeToString = FunctionPrototype.toString;\nvar nameRE = /^\\s*function ([^ (]*)/;\nvar NAME = 'name';\n\n// Function instances `.name` property\n// https://tc39.es/ecma262/#sec-function-instances-name\nif (DESCRIPTORS && !FUNCTION_NAME_EXISTS) {\n  defineProperty(FunctionPrototype, NAME, {\n    configurable: true,\n    get: function () {\n      try {\n        return FunctionPrototypeToString.call(this).match(nameRE)[1];\n      } catch (error) {\n        return '';\n      }\n    }\n  });\n}\n","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./CreateOrder.vue?vue&type=style&index=0&id=45e9bb03&lang=scss&scoped=true\"","import {request} from './request';\r\n\r\n// 创建定单\r\nexport function createOrder(params) {\r\n    return request({\r\n        url:'/api/orders',\r\n        method: 'post',\r\n        params\r\n    })\r\n}\r\n\r\n// 获取定单预览\r\nexport function getOrderPreview() {\r\n    return request({\r\n        url:'/api/orders/preview'\r\n    })\r\n}\r\n\r\n// 定单支付, 获取二维\r\nexport function payOrder(order, params) {\r\n    return request({\r\n        url:`/api/orders/${order}/pay`,\r\n        params\r\n    })\r\n}\r\n\r\n// 定单状态\r\nexport function payOrderStatus(order) {\r\n    return request({\r\n        url:`/api/orders/${order}/status`\r\n    })\r\n}\r\n\r\n// 获取定单列表 {page:1, status:2, include:'user,orderDetail.goods'}\r\nexport function getOrderList(params) {\r\n    return request({\r\n        url:'/api/orders',\r\n        method: 'get',\r\n        params\r\n    })\r\n}\r\n\r\n// 定单详情\r\nexport function getOrderDetail(order) {\r\n    return request({\r\n        url:`/api/orders/${order}`,\r\n        params: {\r\n            include:'user,orderDetails.goods'\r\n        }\r\n    })\r\n}\r\n\r\n// 确认定单\r\nexport function confirmOrder(order) {\r\n    return request({\r\n        url:`/api/orders/${order}/confirm`,\r\n        method: 'patch'\r\n    })\r\n}\r\n\r\n// 获取物流信息 /api/orders/{order}/express\r\nexport function viewExpress(order) {\r\n    return request({\r\n        url:`/api/orders/${order}/express`\r\n    })\r\n}"],"sourceRoot":""}